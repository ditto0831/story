<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í† ë¦¬ ë§Œë“¤ê¸° - í”„ë¡œí•„</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì • */
        :root {
            --bg-color: #121212;
            --bg-secondary: #1e1e1e;
            --text-color: #ffffff;
            --text-muted: #a0a0a0;
            --accent-color: #ff4747;
            --border-color: #333333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-color); line-height: 1.5; }

        /* ë ˆì´ì•„ì›ƒ */
        .container { display: flex; max-width: 1200px; margin: 0 auto; padding: 20px; gap: 40px; }
        .main-content { flex: 2; }
        .sidebar { flex: 1; }

        /* í—¤ë” & ë‚´ë¹„ê²Œì´ì…˜ */
        .site-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; border-bottom: 1px solid var(--border-color); background: var(--bg-secondary);
        }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { color: var(--text-muted); text-decoration: none; font-size: 0.9rem; }
        .nav-links a.active { color: var(--text-color); font-weight: bold; border-bottom: 2px solid var(--accent-color); padding-bottom: 5px;}

        /* íŒŒì¼ ì¡°ì‘ ë²„íŠ¼ ì˜ì—­ */
        .file-actions { display: flex; gap: 10px; }
        .btn-file {
            padding: 6px 12px; font-size: 0.85rem; border-radius: 4px; cursor: pointer; border: 1px solid #444; background: #333; color: white;
        }
        .btn-file:hover { background: #444; }

        /* í˜ì´ì§€ ì œëª© */
        .page-title { font-size: 1.5rem; font-weight: bold; margin-bottom: 20px; padding-left: 20px; }
        .warning-box { background-color: #2a2a2a; padding: 15px; border-radius: 8px; margin-bottom: 30px; font-size: 0.9rem; color: var(--text-muted); }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .form-group { margin-bottom: 25px; }
        .form-label { display: block; font-weight: bold; margin-bottom: 10px; }
        .form-label span { color: var(--accent-color); }
        .form-input, .form-textarea {
            width: 100%; padding: 12px; background-color: var(--bg-secondary); border: 1px solid var(--border-color);
            border-radius: 8px; color: var(--text-color); font-size: 1rem;
        }
        .form-textarea { resize: vertical; height: 120px; }
        .char-count { text-align: right; font-size: 0.8rem; color: var(--text-muted); margin-top: 5px; }
        .form-note { font-size: 0.8rem; color: var(--text-muted); margin-top: 10px; }

        /* ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„¹ì…˜ */
        .image-upload-container { display: flex; align-items: flex-start; gap: 20px; }
        .image-preview {
            width: 100px; height: 100px; background-color: var(--bg-secondary); border-radius: 8px;
            background-size: cover; background-position: center; background-repeat: no-repeat;
            border: 1px solid var(--border-color);
        }
        .upload-buttons button {
            padding: 8px 15px; margin-right: 10px; background-color: var(--bg-secondary); border: 1px solid var(--border-color);
            color: var(--text-color); border-radius: 6px; cursor: pointer; font-size: 0.9rem;
        }

        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; }
        .creator-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .creator-card { background-color: var(--bg-secondary); border-radius: 8px; overflow: hidden; padding: 10px; }
        .creator-thumbnail { width: 100%; aspect-ratio: 1/1; background-color: #333; border-radius: 6px; margin-bottom: 10px; }
        .creator-title { font-weight: bold; font-size: 0.95rem; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .creator-desc { font-size: 0.8rem; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg-secondary); padding: 15px 20px;
            display: flex; justify-content: flex-end; border-top: 1px solid var(--border-color);
        }
        .next-button {
            padding: 10px 30px; background-color: var(--accent-color); color: white; border: none; border-radius: 6px;
            font-weight: bold; cursor: pointer; font-size: 1rem;
        }
        .container { padding-bottom: 80px; }
    </style>
</head>
<body>

    <header class="site-header">
        <div style="font-weight:bold;">ìŠ¤í† ë¦¬ ë§Œë“¤ê¸°</div>
        <nav class="nav-links">
            <a href="#" class="active">í”„ë¡œí•„</a>
            <a href="#" onclick="saveAndGo('story.html')">ìŠ¤í† ë¦¬ ì„¤ì •</a>
            <a href="#" onclick="saveAndGo('start_setting.html')">ì‹œì‘ ì„¤ì •</a>
            <a href="#" onclick="saveAndGo('stat_setting.html')">ìŠ¤íƒ¯ ì„¤ì •</a>
        </nav>
        
        <div class="file-actions">
            <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="loadJsonFile(this)">
            <button class="btn-file" onclick="document.getElementById('jsonFileInput').click()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button class="btn-file" onclick="saveJsonFile()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
        </div>
    </header>

    <h1 class="page-title">í”„ë¡œí•„ ì„¤ì •</h1>

    <div class="container">
        <main class="main-content">
            <div class="warning-box">
                ë¯¼ê°í•œ ìŠ¤í† ë¦¬ì˜ ê²½ìš° ì œì‘ ì‹œ ì„±ì¸ ì¸ì¦ì´ í•„ìš”í•´ìš”.
            </div>

            <form id="profileForm">
                <div class="form-group">
                    <label class="form-label">ì´ë¯¸ì§€ <span>*</span></label>
                    <div class="image-upload-container">
                        <div id="imagePreview" class="image-preview" style="background-image: url('data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22 fill=%22none%22 stroke=%22%23666%22><rect x=%223%22 y=%223%22 width=%2218%22 height=%2218%22 rx=%222%22/><circle cx=%228.5%22 cy=%228.5%22 r=%221.5%22/><polyline points=%2221 15 16 10 5 21%22/></svg>');"></div>
                        <div class="upload-buttons">
                            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 10px;">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ URLì„ ì…ë ¥í•˜ì„¸ìš”.</p>
                            <button type="button" onclick="alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ì€ ì„œë²„ê°€ í•„ìš”í•©ë‹ˆë‹¤. JSON ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.')">ì—…ë¡œë“œ</button>
                            <button type="button" onclick="clearImage()">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ì´ë¦„ <span>*</span></label>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 5px;">2~30ì ì´ë‚´ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”</p>
                    <input type="text" id="charName" class="form-input" placeholder="ìŠ¤í† ë¦¬ì˜ ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”" maxlength="30">
                    <div class="char-count"><span id="nameCount">0</span> / 30</div>
                </div>

                <div class="form-group">
                    <label class="form-label">í•œ ì¤„ ì†Œê°œ <span>*</span></label>
                    <textarea id="simpleDesc" class="form-textarea" placeholder="ì–´ë–¤ ìŠ¤í† ë¦¬ì¸ì§€ ì„¤ëª…í•  ìˆ˜ ìˆëŠ” ê°„ë‹¨í•œ ì†Œê°œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”" maxlength="30"></textarea>
                    <div class="char-count"><span id="descCount">0</span> / 30</div>
                </div>

                <p class="form-note">â“˜ ìš•ì„¤, í˜ì˜¤, ëª…ì˜ˆí›¼ì† ë“±ì˜ í‘œí˜„ ë° ì´ë¯¸ì§€ëŠ” ìš´ì˜ì •ì±…ì— ë”°ë¼ ì œì¬ë  ìˆ˜ ìˆì–´ìš”.</p>
            </form>
        </main>

        <aside class="sidebar">
            <h2 class="sidebar-title">ë– ì˜¤ë¥´ëŠ” ì‹ ì˜ˆ ì°½ì‘ìë“¤</h2>
            <div class="creator-grid">
                <div class="creator-card">
                    <div class="creator-thumbnail"></div>
                    <div class="creator-title">ì˜ˆì‹œ ì‘í’ˆ 1</div>
                    <div class="creator-desc">ì„¤ëª…...</div>
                </div>
            </div>
        </aside>
    </div>

    <div class="bottom-bar">
        <button class="next-button" onclick="saveAndGo('story.html')">ë‹¤ìŒ</button>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜: ì „ì²´ ë°ì´í„°ë¥¼ ë‹´ì„ ê°ì²´ (ì´ˆê¸° êµ¬ì¡°)
        let globalData = {
            prompt: {
                name: "",
                simpleDescription: "",
                profileImage: { origin: "" }
            },
            // ë‹¤ë¥¸ í˜ì´ì§€ì˜ ë°ì´í„° êµ¬ì¡°ë„ ì—¬ê¸°ì— ìœ ì§€ë¨
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ: LocalStorageì— ì €ì¥ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜´
        window.onload = function() {
            const savedData = localStorage.getItem('storyData');
            if (savedData) {
                globalData = JSON.parse(savedData);
                applyDataToForm();
            }
        };

        // [ê¸°ëŠ¥ 1] JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadJsonFile(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    console.log("JSON Loaded:", json);

                    // ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•© (ë¶ˆëŸ¬ì˜¨ íŒŒì¼ì´ ìš°ì„ )
                    globalData = { ...globalData, ...json };

                    // í™”ë©´ì— ë°˜ì˜
                    applyDataToForm();
                    
                    // LocalStorageì— ì €ì¥ (ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œë„ ì“°ê¸° ìœ„í•´)
                    localStorage.setItem('storyData', JSON.stringify(globalData));
                    
                    alert('íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
                } catch (err) {
                    alert('JSON íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    console.error(err);
                }
            };
            reader.readAsText(file);
        }

        // ë°ì´í„° -> í™”ë©´ ì…ë ¥ì°½ì— ì ìš©í•˜ëŠ” í•¨ìˆ˜
        function applyDataToForm() {
            if (globalData.prompt) {
                // ì´ë¦„
                if (globalData.prompt.name) {
                    document.getElementById('charName').value = globalData.prompt.name;
                    updateCount('charName', 'nameCount');
                }
                // í•œ ì¤„ ì†Œê°œ (JSONì˜ simpleDescription ë˜ëŠ” detailDescription í™œìš©)
                if (globalData.prompt.simpleDescription) {
                    document.getElementById('simpleDesc').value = globalData.prompt.simpleDescription;
                    updateCount('simpleDesc', 'descCount');
                }
                // ì´ë¯¸ì§€ (í”„ë¡œí•„ ì´ë¯¸ì§€ URLì´ ìˆë‹¤ë©´)
                if (globalData.prompt.profileImage && globalData.prompt.profileImage.origin) {
                    const imgUrl = globalData.prompt.profileImage.origin;
                    document.getElementById('imagePreview').style.backgroundImage = `url('${imgUrl}')`;
                }
            }
        }

        // [ê¸°ëŠ¥ 2] JSON íŒŒì¼ ì €ì¥í•˜ê¸°
        function saveJsonFile() {
            // í˜„ì¬ í™”ë©´ì˜ ì…ë ¥ê°’ì„ globalDataì— ìµœì‹ í™”
            updateGlobalDataFromForm();

            // JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ íŠ¸ë¦¬ê±°
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(globalData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "story_data.json");
            document.body.appendChild(downloadAnchorNode); // required for firefox
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        // í˜„ì¬ í¼ ë°ì´í„°ë¥¼ ì „ì—­ ê°ì²´ì— ì—…ë°ì´íŠ¸
        function updateGlobalDataFromForm() {
            if (!globalData.prompt) globalData.prompt = {};
            
            globalData.prompt.name = document.getElementById('charName').value;
            globalData.prompt.simpleDescription = document.getElementById('simpleDesc').value;
            // ì´ë¯¸ì§€ëŠ” URL ë°©ì‹ì´ ì•„ë‹ˆë©´ ë¡œì»¬ íŒŒì¼ ì €ì¥ì´ ì–´ë ¤ìš°ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ìŠ¤í‚µí•˜ê±°ë‚˜ ê¸°ì¡´ ìœ ì§€
            
            // ë³€ê²½ì‚¬í•­ LocalStorageì—ë„ ì €ì¥
            localStorage.setItem('storyData', JSON.stringify(globalData));
        }

        // ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
        function saveAndGo(url) {
            updateGlobalDataFromForm(); // ì´ë™ ì „ ìë™ ì €ì¥
            location.href = url;
        }

        // ê¸€ììˆ˜ ì¹´ìš´íŒ… (UIìš©)
        function updateCount(inputId, countId) {
            const input = document.getElementById(inputId);
            const count = document.getElementById(countId);
            if(input && count) count.innerText = input.value.length;
        }
        document.getElementById('charName').addEventListener('input', () => updateCount('charName', 'nameCount'));
        document.getElementById('simpleDesc').addEventListener('input', () => updateCount('simpleDesc', 'descCount'));

        // ì´ë¯¸ì§€ ì‚­ì œ (ì´ˆê¸°í™”)
        function clearImage() {
            document.getElementById('imagePreview').style.backgroundImage = 'none';
            if(globalData.prompt && globalData.prompt.profileImage) {
                globalData.prompt.profileImage.origin = "";
            }
        }
    </script>
</body>
</html>
